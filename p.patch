From 87bebf81f6f72374cde4a3ec21d2534573a5de2f Mon Sep 17 00:00:00 2001
From: Damian Ospara <damian89m@gmail.com>
Date: Wed, 13 Feb 2019 18:56:20 +0100
Subject: [PATCH 1/1] Redux action on fetch

---
 .gitignore                                    |  2 +-
 client/src/components/list.js                 | 29 ++++++++-----------
 client/src/reducers/reducer.js                |  3 ++
 app.js => routes/app.js                       |  2 +-
 routes/index.js                               |  6 +++-
 package-lock.json => routes/package-lock.json |  0
 package.json => routes/package.json           |  4 +--
 7 files changed, 23 insertions(+), 23 deletions(-)
 rename app.js => routes/app.js (88%)
 rename package-lock.json => routes/package-lock.json (100%)
 rename package.json => routes/package.json (76%)

diff --git a/.gitignore b/.gitignore
index 0c43a1c6..1c22ff01 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,5 +1,5 @@
 # dependencies
-/node_modules
+node_modules
 /.pnp
 .pnp.js
 
diff --git a/client/src/components/list.js b/client/src/components/list.js
index 7a313b08..e5798de1 100644
--- a/client/src/components/list.js
+++ b/client/src/components/list.js
@@ -50,17 +50,9 @@ const styles = theme => ({
 });
 
 class List extends React.Component {
-  state = {
-    store: []
-  };
-  componentDidMount = () => {
-    this.getStore().then(result => this.setState({
-      store: result
-    }))
-  };
 
-  getStore = () => {
-    return fetch("/store/", {
+  componentDidMount = () => {
+    fetch("/store/", {
       method: "GET",
       mode: "cors",
       headers: {
@@ -71,9 +63,9 @@ class List extends React.Component {
         return response.json();
       })
       .then(store => {
-        return store.list;
+        return this.props.prodsFromApiArrived(store.list);
       }) 
-  }
+  };
 
   handleOpenInfo = i => {
     this.props.handleOpenInfo(i);
@@ -94,11 +86,12 @@ class List extends React.Component {
     handleCheckItem(newChecked);
   };
   render() {
-    const { list, classes, checked } = this.props;
+    const { list, classes, checked, store } = this.props;
 
-    console.log('llll', list.value);
+    console.log("ACHTUNG");
+    console.log(store);
 
-    const shoppingList = this.state.store.map((item, index) => (
+    const shoppingList = store.list.map((item, index) => (
       <ListItem
         key={index}
         role={undefined}
@@ -153,7 +146,8 @@ List.propTypes = {
 };
 
 const mapStateToProps = state => {
-  return { list: state.list, checked: state.checked };
+  console.log(state);
+  return { list: state.list, store: state, checked: state.checked };
 };
 
 const mapDispatchToProps = dispatch => {
@@ -162,7 +156,8 @@ const mapDispatchToProps = dispatch => {
     handleCheckItem: newChecked =>
       dispatch({ type: "HANDLE_CHECK", newChecked: newChecked }),
     handleDeleteItem: i => dispatch({ type: "DELETE_ITEM", index: i }),
-    getList: () => dispatch({ type: 'GET_LIST'})
+    getList: () => dispatch({ type: 'GET_LIST'}),
+    prodsFromApiArrived: items => dispatch({type: 'PRODS_ARRIVED', prods: items})
   };
 };
 
diff --git a/client/src/reducers/reducer.js b/client/src/reducers/reducer.js
index 0d468d1d..71f74019 100644
--- a/client/src/reducers/reducer.js
+++ b/client/src/reducers/reducer.js
@@ -21,6 +21,9 @@ const reducer = (state, action) => {
         ...state,
         list: newList
       };
+    case "PRODS_ARRIVED":
+      console.log("PRODS_ARRIVED", action.prods);
+      return { ...state, list: action.prods };
     case "HANDLE_CHECK":
       return { ...state, checked: action.newChecked };
     case "GET_LIST":
diff --git a/app.js b/routes/app.js
similarity index 88%
rename from app.js
rename to routes/app.js
index 46d4dae4..81d2206f 100644
--- a/app.js
+++ b/routes/app.js
@@ -1,6 +1,6 @@
 const express = require("express");
 const bodyParser = require("body-parser");
-const routes = require("./routes/index.js");
+const routes = require("./index.js");
 const app = express();
 const cors = require('cors')
 
diff --git a/routes/index.js b/routes/index.js
index 1332f330..03f27d01 100644
--- a/routes/index.js
+++ b/routes/index.js
@@ -15,7 +15,11 @@ const store = {
      {
        "name": "beerAPI",
        "info": ""
-     }
+     },
+     {
+      "name": "newBeerAPI",
+      "info": "damian"
+    }
    ],
    "activeInfo": 666,
    "checked": [],
diff --git a/package-lock.json b/routes/package-lock.json
similarity index 100%
rename from package-lock.json
rename to routes/package-lock.json
diff --git a/package.json b/routes/package.json
similarity index 76%
rename from package.json
rename to routes/package.json
index 6dd08e3a..733ba615 100644
--- a/package.json
+++ b/routes/package.json
@@ -5,9 +5,7 @@
   "main": "app.js",
   "scripts": {
     "test": "echo \"Error: no test specified\" && exit 1",
-    "start": "concurrently \"npm run server\" \"npm run client\"",
-    "server": "node app.js",
-    "client": "cd client && npm start"
+    "start": "npm run server"
   },
   "author": "",
   "license": "ISC",
-- 
2.17.1

